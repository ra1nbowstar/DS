附件编号：[附件一]
文件名称：《[软件名称] V[版本号] 功能清单》
合同关联：本清单为《[合同全称]》（合同编号：[编号]）不可分割部分，与主合同具有同等法律效力。

一、基础信息

- **软件名称**: :
- **版本号**: :
- **交付环境**: :
- **清单版本**: :
- **生效日期**: :

二、功能模块清单（总纲）

- **子功能细化表**:

    | 功能模块 | 子功能       | 功能描述 | 验收标准 | 优先级 | 备注 |
    |---|-----------|---|---|---:|---|
    | 用户管理 | 账号注册      | 支持手机号+验证码注册，必填字段：手机号、密码、姓名（推荐码可选） | 手机号格式校验；验证码有效期5分钟；手机号唯一；创建成功返回 user_id；接口响应≤500ms | 高 | 需对接短信API |
    | 用户管理 | 登录认证      | 账号密码登录、支持微信小程序一键登录，返回 JWT token（有效期1天） | 密码校验通过；失败计数锁定策略生效（示例：连续5次失败锁定10分钟）；登录成功返回 token 与用户信息；接口响应≤500ms | 高 | 支持 refresh token |
    | 用户管理 | 用户信息维护    | 支持修改昵称、手机号、头像、密码、个人资料 | 修改后返回最新用户信息；字段校验生效；密码修改需原密码或验证码验证；接口响应≤500ms | 中 | 头像通过专门接口上传 |
    | 用户管理 | 地址管理      | 收货地址增/删/改/查、设为默认、退货地址管理 | 默认地址唯一；地址录入带省市区校验；接口返回地址列表且分页；设置默认时原默认取消 | 中 | 地址与用户系统统一管理（见 services/address_service.py） |
    | 用户管理 | 头像上传      | 支持图片上传、裁剪、压缩，返回可访问 URL | 支持 jpeg/png；文件大小≤2MB；图片处理成功并返回 URL；访问权限正确 | 低 | 使用 Pillow 处理，存储到 `pic_data/` |
    | 用户管理 | 密码找回      | 短信验证码找回并重设密码，含强度校验 | 验证码有效且只能使用一次；新密码符合强度规则；操作有记录和时戳 | 高 | 需短信 API 集成 |
    | 用户管理 | 绑定推荐人     | 用户可通过推荐码或推荐人手机号绑定推荐人关系 | 推荐关系唯一且不可重复绑定；绑定后在用户信息中可见上级信息 | 低 | 绑定需防止循环引用 |
    | 用户管理 | 查询直推/团队   | 支持查询直推用户列表与团队列表（可递归至 N 层，默认6层） | 支持分页与筛选；返回层级与关系链；响应合理时间（示例≤1s） | 低 | 支持导出报表 |
    | 用户管理 | 用户列表与导出   | 管理端分页筛选用户并支持导出json | 筛选条件正确、导出数据完整性校验通过；导出文件格式正确，导出时间≤30s（小于10k条） | 中 | 导出需相应权限 |
    | 用户管理 | 冻结/注销     | 管理端冻结用户/用户自助注销（逻辑删除） | 冻结后不可登录、不可下单；注销为逻辑删除并保留必要数据（按保留期策略） | 高 | 注销需二次确认与备份 |
    | 用户管理 | 会员升级/设置等级 | 支持用户升级会员、后台调整等级 | 升级后权限/价格生效；历史变更记录保存；升级接口幂等 | 中 | 可能涉及支付或后台审批 |
    | 用户管理 | 多类型积分管理   | 支持会员积分、商家积分、可提现余额、推荐/团队/周补贴/联创专用点数的增减与查询                | Decimal(10,4)精度保证；余额实时更新；流水记录完整；四种专用点查询准确；接口响应≤500ms |   高 | 积分增减需记录原因；支持正负值操作；points\_log表不存在时自动创建                  |
    | 用户管理 | 联创自动晋升    | 基于直推六星数、有效线数、团队总六星数自动计算并晋升联创等级（1-3星）                    | 算法严格符合ABCD条件；过滤已注销用户；晋升原子操作；状态查询≤1s；晋升记录可审计          |   高 | 递归查询深度6层；自动创建user\_unilevel表；后端计算避免前端篡改；需每日任务刷新计数       |
    | 用户管理 | 商户身份授予与查询 | 后台授予用户商户身份，支持设置专属退货地址                                   | Admin key验证；动态添加is\_merchant字段；重复授予返回提示；状态查询准确       |   中 | 需admin2025/gm2025口令；授予后可设置addr\_type='return'地址         |
    | 用户管理 | 平台退货地址配置  | 管理员设置平台级退货地址（user\_id=0），所有用户可公开查询                      | 公开接口无需认证；admin key修改；唯一默认地址；外键约束临时禁用                 |   中 | 特殊user\_id=0标识；查询接口无权限限制；修改时需SET FOREIGN\_KEY\_CHECKS=0 |
    | 用户管理 | 优惠券查询     | 查询用户优惠券列表，支持按状态筛选（未使用/已使用/已过期/全部）                       | 分页准确；状态筛选有效；过期状态自动计算；返回完整券信息；接口响应≤500ms              |   中 | 需coupons表结构；user\_id为必填查询参数；支持all/unused/used/expired筛选 |
    | 用户管理 | 后台手机号管理   | 管理员通过用户ID查询手机号或直接修改（无需验证码）                              | Admin key验证；新旧手机号格式校验；重复性检查；修改原子性；接口响应≤500ms         |   低 | 需gm2025口令；跳过短信验证用于紧急场景；操作需记录审计                          |
    | 用户管理 | 数据库动态兼容   | 自动检测并创建缺失的业务字段（status/member\_level/is\_merchant/积分字段等） | SHOW COLUMNS检测准确；ALTER TABLE成功；无数据丢失；启动时自动执行；兼容老库    |   高 | 核心兼容性设计；所有业务接口前置检测；支持平滑升级；需数据库DDL权限                     |

    

  - **验收占位**: 每项功能在最终清单中需填入“功能描述 / 接口示例 / 验收标准（步骤） / 优先级 / 备注（对接/特殊权限/数据迁移）”。

- **模块**: 订单系统
  - **子功能细化表**:

    | 功能模块 | 子功能 | 功能描述 | 验收标准 | 优先级 | 备注 |
    |---|---|---|---|---:|---|
    | 订单系统 | 购物车管理 | 支持加入、移除、更新数量、批量勾选与清空；购物车与库存、商品上下架状态联动 | 加入/移除/更新接口响应≤500ms；选中状态正确影响结算；并发扣减前校验选中项库存；数据一致性经抽样检查通过 | 高 | 购物车接口应支持批量操作 |
    | 订单系统 | 订单创建 | 支持购物车结算与立即购买；地址/自提选项；生成唯一 `order_number`；库存校验与事务性写入订单与明细 | 创建成功返回 `order_number`；下单过程原子性（库存扣减、订单明细、分账在同一事务或补偿机制）；重复提交幂等处理；接口响应≤1s | 高 | 需考虑乐观/悲观锁策略 |
    | 订单系统 | 库存校验与扣减 | 下单时校验 SKU 库存并扣减，支持库存回滚（退款/取消） | 并发场景库存不出现负数；扣减与回滚日志完整；库存变更记录可审计 | 高 | 与 `product_skus` 表字段关联 |
    | 订单系统 | 支付对接 | 支持微信，处理支付回调并触发财务结算与订单状态变更 | 支付回调幂等；支付成功后结算逻辑（分账/积分/优惠）正确；回调异常重试策略；支付成功率指标（合同可填） | 高 | 需商户密钥与沙箱测试账号 |
    | 订单系统 | 积分与优惠券抵扣 | 在支付前校验并应用积分与优惠券，计算实际应付金额 | 抵扣计算正确、不能超额抵扣；抵扣并发安全；使用后状态变更不可重复使用 | 中 | 抵扣规则外放配置 |
    | 订单系统 | 订单状态流转 | 支持状态：`pending_pay`/`pending_ship`/`pending_recv`/`completed`/`refund`/`refunded` 等，提供管理员与用户端查询与变更接口 | 状态变更符合业务规则（例如支付后变为待发货）；状态更改幂等；通知/消息触发正确 | 高 | 发货后自动收货策略需明示 |
    | 订单系统 | 商家发货与快递跟踪 | 写入快递单号并变更状态，支持商家查询订单与批量发货 | 发货接口返回成功率高；跟踪号保存并可回溯；查询时包含订单商品明细 | 中 | 支持导出发货单 |
    | 订单系统 | 退款与退货管理 | 支持用户申请退款/退货、商家/平台审核、退货地址填写、退款回退资金处理 | 退款申请有唯一记录；审核后资金回滚（调用 reverse_split_on_refund）并验证账目平衡；退货地址必须在同意退货时提供 | 高 | 需要与财务模块对账 |
    | 订单系统 | 自动取消与自动收货 | 支持过期未支付自动取消；已发货过期自动确认收货（可配置天数） | 守护任务稳定运行；自动操作记录；取消/自动收货触发相应的库存或结算逻辑 | 中 | 存在守护线程/定时任务（见 order.py） |
    | 订单系统 | 订单查询与详情 | 支持按用户、订单号、状态、多条件查询；详情返回用户、地址、商品明细、支付与物流信息 | 列表支持分页与筛选；详情接口返回完整结构、字段无歧义；查询响应≤1s（小数据集） | 高 | 包含第一条商品摘要与规格 |
    | 订单系统 | 商家后台订单管理 | 商家可按状态查询、发货、审核退款、查看结算明细 | 权限隔离；商家操作仅作用于其订单范围；结算明细与流水一致 | 中 | 商家与平台权限需区分 |
    | 订单系统 | 报表与导出 | 支持按日/周/月导出销售报表、订单明细、退款统计 | 导出文件格式正确、数据完整；导出性能满足约定（示例：≤30s 小于10k条） | 低 | 可异步生成并通知下载 |

    - **验收占位**: 每项功能需补充“接口示例（URL/方法/请求体/响应示例）”、“验收步骤（逐条测试点）”、“性能与容错要求”、“边界与异常场景”。

- **模块**: 商品管理
  - **子功能细化表**:

| 功能模块 | 子功能                   | 功能描述                                                              | 验收标准                                                                                           | 优先级 | 备注                                                                                                                                             |
| ---- | --------------------- | ----------------------------------------------------------------- | ---------------------------------------------------------------------------------------------- | --- |------------------------------------------------------------------------------------------------------------------------------------------------|
| 商品管理 | 商品列表（分页）              | 支持按分类/状态/商家/关键字分页查询，返回商品摘要与第一条SKU                                 | 分页正确，筛选条件生效；查询响应≤1s（常规数据量）                            | 高   | 支持页码/大小限制，最大100/页                                                                                                                              |
| 商品管理 | 商品详情                  | 返回商品所有字段、SKUs、属性、图片、商家信息、销售数据                                     | 字段无缺失；SKU 中 price/original\_price/stock/specifications 正确；图片能访问                                | 高   | 接口需兼容旧字段格式（main\_image 字符串或 JSON 列表）；                                                                                                          |
| 商品管理 | 商品搜索                  | 支持模糊搜索（名称/描述/SKU/拼音/分类/商家），按关键词拆词检索                               | 搜索结果相关度合理；支持多词 AND 策略；返回去重列表；响应≤1s（小量）                                                         | 高   | 支持拼音、商家名检索；**【新增】**&#x4EC5;搜索 is\_merchant=1 的认证商家，避免搜索到普通用户                                                                                   |
| 商品管理 | 新增商品                  | 支持创建商品及多 SKU、attributes；会员商品强制价格策略                                | 输入校验（分类/状态/SKU 字段）通过；创建后可查询到新商品及 SKUs；事务提交无残留；**【新增】**&#x70;inyin 字段根据商品名称自动生成，不可手动指定          | 高   | 支持 max\_points\_discount 字段；**【修改】**&#x8FD0;费(freight)系统强制为0；**【修改】**&#x4F1A;员商品SKU价强制为1980，忽略传入值；**【新增】**&#x73;pecifications 自动序列化为 JSON 字符串存储 |
| 商品管理 | 更新商品（含SKU）            | 支持更新商品基础信息、SKU 列表（整体替换模式）、attributes；会员商品价格灵活控制                   | 更新后查询一致；更新后查询一致;SKU更新需幂等;会员商品价格按照规则强制或可用接口覆盖                               | 中   | **【修改】**&#x4F1A;员商品价格策略：未提供SKU参数时统一改为1980，提供SKU参数时按传入值更新；**【新增】**&#x73;pecifications 更新时自动序列化为 JSON 字符串                                        |
| 商品管理 | SKU 管理                | **【修改】**&#x53;KU 无独立增删接口，通过商品更新接口全量替换管理；支持改、库存与价格、规格字段（JSON）      | SKU 数据校验；库存为非负整数；价格 ≥0；更新后对外展示一致；**【修改】**&#x89C4;格字段为 JSON 字符串存储                               | 高   | SKU 必须指向 product\_id；**【新增】**&#x6F;riginal\_price 和 specifications 字段支持                                                                        |
| 商品管理 | 图片上传与处理               | 支持详情图/轮播图上传、裁剪、压缩、追加策略，保存到 `pic_data/分类/商品ID/`                    | 支持 JPG/PNG/WEBP；单图大小限制（详情≤3MB、Banner≤5MB）；上传后返回可访问 URL；处理耗时合理                                  | 中   | 使用 Pillow 处理                                                                                                                                   |
| 商品管理 | 图片管理（删除）              | 支持删除指定图片并同步删除文件与 Banner 表记录                                       | 删除后数据库与文件系统一致；**【修改】**&#x8F6E;播图删除时同步删除 banner 表对应记录；**【新增】**&#x81EA;动移除/pic/前缀并删除物理文件；接口返回删除结果 | 中   | 物理文件路径以 `/pic/` 前缀约定                                                                                                                           |
| 商品管理 | 图片管理（追加更新）            | **【新增】**&#x652F;持追加式更新图片（不覆盖原有），通过 image\_type 明确区分轮播图/详情图        | 追加后图片列表完整；原有图片不受影响                       | 中   | **【新增】**&#x72EC;立 PUT `/products/{id}/images` 接口实现追加功能，通过 image\_type 参数区分类型                                                                   |
| 商品管理 | 轮播图/Banner 管理         | 管理商品 Banner 列表、状态与排序；**【新增】**&#x67E5;询商品关联的所有轮播图                  | Banner 列表查询正确；**【修改】**&#x65B0;增/追加 Banner 时同步插入 banner 表；轮播图显示顺序正确                             | 低   | Banner 支持上下架与排序字段；**【新增】**&#x47;ET `/banners` 接口支持按 product\_id 筛选                                                                             |
| 商品管理 | 库存管理                  | SKU 库存管理、**【修改】**&#x4EE3;码未实现库存阈值报警，需依赖订单系统库存扣减逻辑                 | **【修改】**&#x5E93;存扣减由订单系统实现，商品模块仅存储当前库存值；并发扣减需订单系统保证不产生负库存                                      | 高   | 需与下单/退货流程联动；**【修改】**&#x5546;品模块自身无库存报警实现                                                                                                       |
| 商品管理 | 会员商品规则                | 支持标记会员商品、固定会员价1980、购买规则说明与权益描述            | 会员商品在接口中标识明确；会员价格生效并受限；购买规则展示正确                                                                | 中   | **【新增】**&#x47;ET `/products/{id}/rules` 接口返回会员价、规则说明；**【修改】**&#x4EF7;格策略：新增时强制1980，更新时根据是否提供SKU参数灵活处理                                          |
| 商品管理 | 商品上下架与状态管理            | 支持草稿/上架/下架/缺货等状态变更并影响展示                                           | 上下架变更生效即时；下架商品不出现在搜索/列表                                                                        | 高   | 状态变更需权限控制；**【新增】**&#x73;tatus 字段支持 0=草稿 1=上架 2=下架 3=缺货                                                                                         |
| 商品管理 | 商品销售统计                | 提供单品销售量/销售额统计（仅已支付或已完成订单）                                         | 统计口径明确（仅计已支付或已完成订单）；查询结果与财务报表一致                                                                | 中   | 查询性能可异步或缓存；**【新增】**&#x47;ET `/products/{id}/sales` 接口返回 qty 和 sales                                                                            |
| 商品管理 | 权限与商家隔离               | 支持按 `user_id`（商家）管理商品，仅允许商家操作其商品                                  | 商家只能操作自己商品；管理端具备更高权限                                                                           | 中   | 支持后台审核/审批流；**【新增】**&#x67E5;询列表支持按 user\_id 筛选；**【新增】**&#x641C;索商家时仅匹配 is\_merchant=1 的用户                                                       |
| 商品管理 | **【新增】**&#x5546;品分类依赖 | **【新增】**&#x5546;品分类来自 `core.config.CATEGORY_CHOICES` 配置，无独立分类管理接口 | 分类值必须在配置列表中；创建/更新商品时校验分类有效性                                                                    | 中   | **【新增】**&#x5206;类配置硬编码，需修改代码才能变更分类                                                                                                             |
| 商品管理 | **【新增】**&#x8FD0;费固定策略 | **【新增】**&#x7CFB;统强制所有商品运费为0，freight 字段写入和更新均固定为0.00               | freight 字段在任何操作中保持为0；数据库值与实际策略一致                                                               | 低   | **【新增】**&#x50;ydantic 模型中 freight 字段有 le=0 限制，确保值为0                                                                                            |

  - **验收占位**：每项应补充"接口示例（URL/方法/请求/响应）"、"验收步骤（功能点与异常用例）"、"性能及并发要求（例如导出/搜索）"与"第三方依赖/注意事项（如图片存储、Pillow库、权限控制）"。

- **模块**: 财务系统
  - **子功能细化表**:

    | 功能模块 | 业务能力 | 功能描述 | 对应代码 | 验收标准 | 优先级 | 备注 |
    |---|---|---|---|---:|---:|---|
    | 支付接入与回调 | 支付回调、幂等与重放 | 支持支付渠道回调处理、幂等校验、回放日志 | `api/finance/routes.py`：支付回调路由（示例 `/api/pay/notify`）→ 调用 `FinanceService.settle_order(order_no, user_id, order_id, ...)`；说明：路由负责幂等键校验与参数解析，业务由 `settle_order` 完成（分账/写流水/积分处理）。 | 回调幂等；支付成功触发结算；沙箱测试通过 | 高 | 需商户证书、回调域名白名单；记录回放/死信 |
    | 交易结算与分账 | 订单结算、资金拆分 | 根据配置把实际支付金额分配到平台/补贴/公益/公司积分等池子，并写 `account_flow` | `services/finance_service.py`：`_allocate_funds_to_pools_v2(order_id, total_amount)`（资金池分配逻辑）；`split_order_funds(order_number, total, is_vip)` / `_execute_split`（拆分调度与执行）；`database_setup.py`：`_init_finance_accounts()`（初始化池子）。说明：分账逻辑集中在 finance_service，拆分支持异步/事务重试。 | 分配守恒；账本可回溯；并发无负余额 | 高 | 配置化可调整；注意 `Decimal` 精度与并发锁 |
    | 退款与回退 | 逆向分账与积分回退 | 部分/全额退款时回退对应资金、积分、修正流水 | `services/finance_service.py`：`refund_order(order_no)`（退款入口）；`reverse_split_on_refund(order_number)`（反向分账）；同时调用 `_insert_account_flow` 与 `_insert_points_log` 修正账本。说明：退款需保留原分账 trace_id，以便精确回冲与审计。 | 退款后各方余额与流水一致；支持重入 | 高 | 支持部分退款；保留原分账 trace_id 以便回冲 |
    | 提现与打款 | 提现申请、审核、打款、税费 | 提现扣减余额/生成流水、打款回调更新状态 | `services/finance_service.py`：`apply_withdrawal(user_id, amount, withdrawal_type)`（发起）；`audit_withdrawal(withdrawal_id, approve, auditor)`（审核/打款）；底层使用 `_record_flow`、`_insert_account_flow` 写账。说明：审核流程需幂等，打款回调更新流水并支持人工介入。 | 提现流程幂等；打款状态可追溯 | 高 | 合规/税务字段必填；支持人工复核与重试 |
    | 资金池治理 | 池子配置、初始化与调整 | 多资金池管理、配置化分配比例、审计变更 | `database_setup.py`：`_init_finance_accounts()`（初始化）；`services/finance_service.py`：`get_pool_allocations()`、`_validate_allocations(allocs)`（读取与校验）；说明：变更需权限与审计，配置须保证总比例/逻辑守恒。 | 配置生效并写审计；分配合规 | 高 | 变更需审计与权限控制；变更需验证守恒 |
    | 账本与对账 | 账本/流水记录与对账脚本 | 所有余额变更写 `account_flow` 和 `points_log`（4位小数），提供对账导出 | `services/finance_service.py`：`_insert_account_flow(...)`、`_get_balance_after(account_type)`、`_insert_points_log(...)`（账本写入/余额读取）；`api/finance/routes.py`：报表路由负责导出。说明：账本写入必须和业务同事务，支持 CSV/Excel 导出。 | 账本可复现余额；对账脚本通过抽样验证 | 高 | 导出 CSV/Excel；流水保留期与合规要求（示例：1 年） |
    | 积分与奖励 | 积分发放、抵扣、推荐/团队奖励 | 会员积分发放、抵扣精度到小数、奖励创建与审核 | `services/finance_service.py`：`_apply_points_discount_v2(cur, user_id, user, points_to_use, amount)`（积分抵扣逻辑）；`_create_pending_rewards_v2(cur, order_id, buyer_id, ...)`（创建奖励条目）；`audit_and_distribute_rewards(reward_ids, approve, auditor)`（审核并发放）。说明：所有积分使用 `Decimal`，记录 `points_log`（4 位小数）。 | 积分精度正确；奖励可审核并发放；发放可回滚 | 中 | 积分使用 Decimal(4) 精度；发放伴随通知（站内/邮件） |
    | 补贴与定时发放 | 周补贴、联创分红发放流程 | 发放预览、批量发放、异步/定时任务 | `services/finance_service.py`：`distribute_weekly_subsidy()`、`get_current_points_value()`、`adjust_subsidy_points_value(points_value, auto_clear)`；`api/finance/routes.py`：`/api/subsidy/*` 路由。说明：支持预览与手动调整，任务需实现幂等与防重放。 | 预览与实际一致；任务幂等 | 中 | 任务幂等，支持发放预览与人工调整 |
    | 报表与导出 | 财务总览、池子、提现、退款、积分流水 | 支持分页/导出/权限控制 | `api/finance/routes.py`：报表路由（如 `/api/reports/*`），调用 `FinanceService` 中的查询方法（分页与导出）；说明：长耗时导出建议异步生成并通知下载。 | 报表与账本一致；导出性能满足合同 | 中 | 权限分级导出；支持异步导出与通知 |
    | 风险与审计 | 异常检测、告警、人工工单 | 短款/重复记账/异常打款告警与工单 | `services/finance_service.py`：`audit_and_distribute_rewards`、`audit_withdrawal` 等审核接口；`core.logging`：记录日志；`core.exceptions`：`FinanceException` 抛错。说明：异常需产生日志/告警并创建人工工单，接入外部告警系统。 | 异常生成工单并可追踪；审计链完整 | 高 | 接入告警渠道并生成工单；支持人工复核与平账 |

  - **验收要点（必读）**:

    - 所有涉及余额变更的接口必须在同一事务内写入 `account_flow`，并在同一 cursor/连接上读取 `balance_after`。
    - 所有金额与积分使用 `Decimal`，`points_log` 支持 4 位小数，严禁使用 float 计算。
    - 关键失败应抛出 `FinanceException` 或明确定义的错误，让上层路由返回明确的 4xx/5xx 响应。
    - 所有外部回调（支付/退款）需实现幂等键、重试队列与每日回放日志，确保未出现重复分账。
    - 报表与对账用例需包含导出样例和对账脚本/SQL，便于财务核对。

  - **验收占位**: 每个子功能在最终清单中需补充“接口示例 / 接口权限 / 逐条验收步骤（含对账用例）/ 性能与时效要求（如提现审核时限、批量结算耗时）/ 异常回滚用例 / 第三方依赖（支付网关、银行接口）”。

- **模块**: 系统/平台管理
  - **子功能细化表**:

    | 功能模块 | 子功能 | 功能描述 | 验收标准 | 优先级 | 备注 |
    |---|---|---|---|---:|---|
    | 系统/平台管理 | 系统配置管理 | 提供可视化/接口化的系统全局配置项管理（如站点信息、邮件/短信、第三方密钥、限流阈值） | 配置修改即时生效或按说明重载；可通过接口读取当前配置；配置变更有审计记录 | 高 | 支持导入/导出配置，权限控制 |
    | 系统/平台管理 | 轮播句/Banner 文案管理 | 管理首页轮播语句与轮播图语句（新增/修改/查询），缺少记录时自动创建占位 | 查询返回默认记录；更新后前端展示生效；接口返回最新数据 | 低 | 参见 `api/system/routes.py` 语句处理逻辑 |
    | 系统/平台管理 | 日志与审计 | 集中记录操作日志、系统错误日志、审计重要财务/管理员操作，并支持查询/导出 | 日志按级别写入文件/存储；审计记录包含操作者、时间、IP、变更前后值；支持按条件导出 | 高 | 日志滚动策略与保留期需约定（例如 90 天） |
    | 系统/平台管理 | 定时任务与守护进程 | 管理和监控定时任务（如订单过期取消、自动收货、周补贴发放），支持重试与幂等执行 | 定时任务按计划触发并完成预期动作；任务运行记录可查询；失败可重试且不产生重复副作用 | 中 | 需提供任务状态/日志界面 |
    | 系统/平台管理 | 管理员与权限管理 | 支持角色/菜单权限配置、多级管理员账号、权限即时生效与角色回收 | 权限变更后被限制的操作返回403；角色管理功能穩定无权限泄露 | 高 | 支持基于角色与基于资源的细粒度权限 |
    | 系统/平台管理 | 接口限流与防护 | 全局/接口级限流、IP 黑白名单、请求速率限制、简单防刷/反爬策略 | 达到限流阈值返回规范错误码；限流规则生效且可配置；异常流量告警触发 | 高 | 可与网关或中间件协作实现 |
    | 系统/平台管理 | 健康检查与监控 | 提供服务健康检查接口、Prometheus 指标、错误与性能告警 | 健康接口返回服务状态；指标覆盖CPU/内存/请求QPS/错误率；关键告警触达渠道 | High | 集成 Prometheus/Grafana 或类似监控系统 |
    | 系统/平台管理 | 文件与静态资源管理 | 管理静态目录、图片存储策略、CDN 配置、备份与清理策略 | 上传/访问静态资源正常；图片处理后可访问；定期清理策略有效 | 中 | 使用 `pic_data/` 路径约定，支持外部存储扩展 |
    | 系统/平台管理 | 运维与部署支持 | 部署脚本、迁移脚本、环境配置模板、回滚策略与灰度发布支持 | 按文档能快速部署/回滚；迁移脚本无数据丢失；灰度发布能按配置路由一部分流量 | 中 | 提供 `pyproject.toml` / 部署说明 |
    | 系统/平台管理 | 备份与恢复 | 数据库和关键文件定期备份、备份验证、恢复演练 | 备份任务完成率 100%；恢复演练成功并产出报告；恢复时间满足合同约定 | 高 | 备份保留期、恢复点 (RPO/RTO) 在合同中明确 |
    | 系统/平台管理 | 运维权限与变更审批 | 运维操作（如手工调账/数据修复/脚本执行）需审批并记录 | 运维变更有审批流程并记录；审批后操作可回溯且有回滚方案 | High | 高风险操作双人/多级审批 |
    | 系统/平台管理 | 多环境支持 | 支持独立的开发/测试/预发布/生产环境配置与数据隔离 | 各环境间配置与数据隔离；部署脚本支持多环境参数 | 中 | 环境配置示例提供在交付物中 |
    | 系统/平台管理 | 系统通知与消息 | 提供邮件/短信/站内信模板管理与发送接口，支持任务异步发送与失败重试 | 模板可配置；发送记录可查询；发送失败自动重试并告警 | Medium | 需对接短信/邮件服务商 |
    | 系统/平台管理 | 运维自助工具 | 提供常用运维工具（清理缓存、重跑任务、导出日志、手动触发作业） | 工具权限受限；执行后产生可审计记录；工具操作正确无副作用 | Low | 仅限管理员使用 |

  - **验收占位**: 每项功能需补充“接口示例 / 管理页截图或设计说明 / 验收步骤（功能点、异常用例、权限用例）/ SLA 与告警阈值 / 备份与恢复演练计划”。

- **模块**: 接口与集成
  - **子功能占位**: 第三方登录（微信）、短信 API 对接、支付网关（微信）、邮件/通知
  - **验收占位**: 第三方交互成功率、错误处理与重试策略

说明：每个模块在最终合同清单中应展开为表格形式，列出“功能模块 / 子功能 / 功能描述 / 验收标准 / 优先级 / 备注”。

三、非功能要求（关键指标模板）

- **性能**: 支持并发用户： [占位，例如 1000 并发]；API 响应：平均 ≤ [500]ms，95% 响应 ≤ [1s]；页面首屏加载 ≤ [2]s
- **可用性**: SLA 可用率：99.5%（月）
- **扩展性**: 支持水平扩容，数据库与静态资源分离部署
- **安全**: 敏感数据加密：[AES/RSA]；密码加密：bcrypt；登录失败锁定策略：连续 N 次失败锁定 M 分钟；操作审计：管理员操作留痕
- **兼容性**: 浏览器：Chrome/Edge/Safari 最新两代；移动端：iOS 、Android
- **可维护性**: 提供接口文档（OpenAPI/Swagger）、部署手册、源码注释覆盖率 ≥ 80%
- **备份与恢复**: 数据库每日备份，备份保留期：30 天，恢复时长目标 ≤ 4 小时

四、验收与变更规则（模板）

- **验收标准**：按清单“验收标准”项逐条测试，单项通过后标注为“已通过”；整体通过率 100% 为合格交付。
- **验收流程**：
  1. 乙方完成开发并提交测试环境；
  2. 甲方在约定时间内（例如 10 个工作日）完成功能验证并提交问题清单；
  3. 乙方在约定修复周期内修复并提交复测；
  4. 双方确认全部条目通过后签署验收单。
- **变更流程**：任何功能增删改均需双方签署《需求变更确认单》，变更同时调整工期与费用。
- **缺陷分级与响应时限**：
  - 紧急（P0）：系统不可用/关键业务中断，响应 ≤ 2 小时，修复或临时解决方案 ≤ 24 小时；
  - 高（P1）：主要功能受影响，响应 ≤ 8 小时，修复或规避措施 ≤ 3 个工作日；
  - 中（P2）：次要功能/界面问题，响应 ≤ 2 个工作日，修复 ≤ 10 个工作日；
  - 低（P3）：建议性改进，双方另行评估排期。

五、交付物与交付标准

- **交付物清单**：源代码（含注释）、部署脚本、依赖清单（pyproject.toml 或 requirements.txt）、数据库初始化脚本、接口文档（OpenAPI）、部署手册、用户手册、测试报告
- **交付标准**：代码能在目标环境按文档部署并启动，接口文档与实际接口一致，关键用例通过测试

六、验收交付时间与里程碑（示例）

- **里程碑1**：需求确认与技术评估 — 日期
- **里程碑2**：开发完成（测试环境） — 日期
- **里程碑3**：甲方测试与问题修复 — 日期
- **里程碑4**：验收与生产部署 — 日期

七、知识产权与源码交付（简要）

- **代码归属**：按主合同约定。若合同约定源码交付，则乙方应提供完整源码与构建说明。
- **第三方组件**：列明所有第三方依赖及许可证，若有商业授权需由甲方另行购买。

八、签署确认

- 甲方（盖章）：__________  代表签字：__________  日期：__________
- 乙方（盖章）：__________  代表签字：__________  日期：__________

